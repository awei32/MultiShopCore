# 用户模块需求文档

## 一、模块概述

### 1.1 模块定位

用户模块是多商户电商系统的核心基础模块，负责管理平台所有用户的身份认证、个人信息、会员体系、权限控制等功能。作为系统的用户中心，为其他业务模块（商品、订单、支付等）提供统一的用户身份服务。

### 1.2 目标用户

- **C端消费者**：个人用户，进行购物、浏览、评价等操作
- **B端商家**：企业用户或个体商户，管理店铺和商品
- **平台管理员**：运营人员，进行平台管理和监控

### 1.3 核心价值

- 提供安全可靠的用户身份认证体系
- 建立完善的用户信息管理机制
- 构建灵活的会员等级和积分体系
- 确保用户数据安全和隐私保护
- 支持多终端统一用户体验

## 二、功能需求

### 2.1 用户认证与授权

#### 2.1.1 用户注册

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 手机号注册 | 支持手机号+验证码注册，验证码有效期5分钟，同一手机号1分钟内只能发送1次 | P0 |
| 邮箱注册 | 支持邮箱+密码注册，邮箱格式校验，发送激活邮件 | P1 |
| 密码规则 | 密码长度8-20位，必须包含大小写字母、数字、特殊字符中至少3种 | P0 |
| 用户协议 | 注册时必须同意用户协议和隐私政策，记录同意时间和版本 | P0 |
| 重复校验 | 手机号、邮箱、用户名唯一性校验，提供友好的错误提示 | P0 |

#### 2.1.2 用户登录

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 多方式登录 | 支持手机号/用户名/邮箱+密码登录 | P0 |
| 验证码登录 | 支持手机号+短信验证码免密登录 | P0 |
| 第三方登录 | 支持微信、支付宝授权登录，自动绑定或创建账户 | P1 |
| 记住登录 | 支持"记住我"功能，7天内免登录 | P1 |
| 登录限制 | 密码错误5次锁定账户30分钟，记录异常登录日志 | P0 |

#### 2.1.3 密码管理

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 密码修改 | 登录状态下修改密码，需验证原密码 | P0 |
| 密码找回 | 通过手机号或邮箱找回密码，支持验证码验证 | P0 |
| 密码加密 | 使用BCrypt算法加密存储，加盐处理 | P0 |
| 密码策略 | 新密码不能与最近3次使用的密码相同 | P1 |

#### 2.1.4 会话管理

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| Token认证 | 使用JWT Token进行身份认证，Token有效期24小时 | P0 |
| 刷新机制 | 提供Refresh Token，有效期7天，支持Token自动刷新 | P0 |
| 单点登录 | 支持多终端登录，同一账户最多5个活跃会话 | P1 |
| 登出功能 | 支持单设备登出和全设备登出 | P0 |

### 2.2 用户信息管理

#### 2.2.1 基础信息

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 个人资料 | 头像、昵称、性别、生日、个人简介等基础信息管理 | P0 |
| 头像上传 | 支持图片上传，限制格式(jpg/png)和大小(2MB)，自动压缩 | P0 |
| 昵称规则 | 昵称长度2-20字符，不允许特殊字符和敏感词 | P0 |
| 信息校验 | 手机号、邮箱格式校验，身份证号码格式校验 | P0 |

#### 2.2.2 联系方式

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 手机号管理 | 手机号绑定/解绑/更换，需短信验证码确认 | P0 |
| 邮箱管理 | 邮箱绑定/解绑/更换，需邮件验证确认 | P0 |
| 联系方式验证 | 绑定的手机号和邮箱必须通过验证才能使用 | P0 |

#### 2.2.3 实名认证

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 身份认证 | 身份证号码+姓名实名认证，对接公安部接口验证 | P0 |
| 认证状态 | 未认证/认证中/已认证/认证失败四种状态 | P0 |
| 认证限制 | 每个身份证只能认证一个账户，认证后不可修改 | P0 |
| 认证权益 | 实名用户享有更高交易限额和特殊功能权限 | P1 |

### 2.3 收货地址管理

#### 2.3.1 地址信息

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 地址录入 | 省市区三级联动选择，详细地址、邮编、收货人、联系电话 | P0 |
| 地址数量 | 每个用户最多保存20个收货地址 | P0 |
| 默认地址 | 支持设置默认收货地址，下单时优先选择 | P0 |
| 地址标签 | 支持设置地址标签：家、公司、学校等 | P1 |

#### 2.3.2 地址操作

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 增删改查 | 新增、编辑、删除、查询地址信息 | P0 |
| 地址验证 | 收货人姓名、手机号格式校验 | P0 |
| 智能推荐 | 根据历史地址智能推荐常用地址 | P1 |

### 2.4 会员体系与积分

#### 2.4.1 会员等级

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 等级划分 | 普通会员(0-999元)、白银会员(1000-4999元)、黄金会员(5000元以上) | P0 |
| 等级计算 | 基于近12个月累计消费金额计算等级 | P0 |
| 等级权益 | 不同等级享受不同折扣：普通95折、白银9折、黄金85折 | P0 |
| 等级展示 | 用户中心显示当前等级、升级进度、权益说明 | P0 |

#### 2.4.2 积分系统

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 积分获取 | 购物返积分(消费1元=1积分)、签到积分(每日5积分)、评价积分(每次10积分) | P0 |
| 积分使用 | 积分抵扣现金(100积分=1元)，单笔订单最多抵扣50% | P0 |
| 积分有效期 | 积分有效期2年，到期前1个月提醒用户 | P0 |
| 积分明细 | 积分获取和使用明细记录，支持按时间筛选查询 | P0 |

### 2.5 安全与隐私

#### 2.5.1 账户安全

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 登录保护 | 异地登录提醒、新设备登录验证 | P0 |
| 操作验证 | 敏感操作(修改密码、绑定手机等)需二次验证 | P0 |
| 安全设置 | 支持设置安全问题、绑定安全邮箱 | P1 |
| 账户冻结 | 支持用户主动冻结账户，管理员强制冻结功能 | P0 |

#### 2.5.2 隐私保护

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 数据加密 | 敏感信息(手机号、身份证)加密存储 | P0 |
| 隐私设置 | 用户可控制个人信息的可见性 | P1 |
| 数据导出 | 支持用户申请导出个人数据 | P1 |
| 账户注销 | 支持用户申请注销账户，数据按法规要求处理 | P1 |

### 2.6 消息通知

#### 2.6.1 通知类型

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 系统通知 | 账户安全提醒、系统维护通知等 | P0 |
| 业务通知 | 订单状态变更、物流更新、促销活动等 | P0 |
| 营销通知 | 个性化推荐、优惠券到期提醒等 | P1 |

#### 2.6.2 通知管理

| 功能点 | 详细需求 | 优先级 |
|--------|----------|--------|
| 通知设置 | 用户可自定义各类通知的接收方式(短信/邮件/推送) | P0 |
| 消息中心 | 站内消息统一管理，支持已读/未读状态 | P0 |
| 推送管理 | APP推送token管理，支持多设备推送 | P1 |

## 三、非功能需求

### 3.1 性能要求

- **响应时间**：用户登录≤1秒，信息查询≤0.5秒，信息更新≤2秒
- **并发能力**：支持10万用户同时在线，登录接口QPS≥1000
- **数据容量**：支持千万级用户数据存储

### 3.2 安全要求

- **数据传输**：所有接口使用HTTPS加密传输
- **数据存储**：敏感信息加密存储，密码使用BCrypt加密
- **访问控制**：基于RBAC权限模型，最小权限原则
- **审计日志**：记录所有用户操作日志，保留6个月

### 3.3 可用性要求

- **系统可用性**：99.9%可用性，年停机时间不超过8.76小时
- **容错能力**：支持数据库主从切换，Redis集群容错
- **备份恢复**：每日数据备份，支持快速恢复

### 3.4 兼容性要求

- **浏览器兼容**：支持Chrome、Firefox、Safari、Edge最新版本
- **移动端适配**：支持iOS 12+、Android 8+
- **API版本**：支持API版本管理，向下兼容

## 四、技术规范

### 4.1 数据库设计

#### 4.1.1 用户基础表(user)

```sql
CREATE TABLE user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码(BCrypt加密)',
    phone VARCHAR(20) UNIQUE COMMENT '手机号',
    email VARCHAR(100) UNIQUE COMMENT '邮箱',
    nickname VARCHAR(50) COMMENT '昵称',
    avatar VARCHAR(255) COMMENT '头像URL',
    gender TINYINT DEFAULT 0 COMMENT '性别:0未知,1男,2女',
    birthday DATE COMMENT '生日',
    status TINYINT DEFAULT 1 COMMENT '状态:0禁用,1正常,2冻结',
    real_name VARCHAR(50) COMMENT '真实姓名',
    id_card VARCHAR(18) COMMENT '身份证号',
    real_name_status TINYINT DEFAULT 0 COMMENT '实名状态:0未认证,1认证中,2已认证,3认证失败',
    member_level TINYINT DEFAULT 1 COMMENT '会员等级:1普通,2白银,3黄金',
    total_amount DECIMAL(10,2) DEFAULT 0 COMMENT '累计消费金额',
    points INT DEFAULT 0 COMMENT '当前积分',
    last_login_time DATETIME COMMENT '最后登录时间',
    last_login_ip VARCHAR(50) COMMENT '最后登录IP',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_phone (phone),
    INDEX idx_email (email),
    INDEX idx_status (status),
    INDEX idx_member_level (member_level)
);
```

#### 4.1.2 用户地址表(user_address)

```sql
CREATE TABLE user_address (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT '用户ID',
    receiver_name VARCHAR(50) NOT NULL COMMENT '收货人姓名',
    receiver_phone VARCHAR(20) NOT NULL COMMENT '收货人电话',
    province VARCHAR(50) NOT NULL COMMENT '省份',
    city VARCHAR(50) NOT NULL COMMENT '城市',
    district VARCHAR(50) NOT NULL COMMENT '区县',
    detail_address VARCHAR(255) NOT NULL COMMENT '详细地址',
    postal_code VARCHAR(10) COMMENT '邮政编码',
    address_label VARCHAR(20) COMMENT '地址标签',
    is_default TINYINT DEFAULT 0 COMMENT '是否默认地址:0否,1是',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_is_default (is_default)
);
```

#### 4.1.3 积分记录表(user_points_log)

```sql
CREATE TABLE user_points_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT '用户ID',
    points INT NOT NULL COMMENT '积分变动数量',
    type TINYINT NOT NULL COMMENT '类型:1获得,2消费',
    source TINYINT NOT NULL COMMENT '来源:1购物,2签到,3评价,4活动,5抵扣',
    order_id BIGINT COMMENT '关联订单ID',
    description VARCHAR(255) COMMENT '描述',
    expire_time DATETIME COMMENT '过期时间',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_type (type),
    INDEX idx_create_time (create_time)
);
```

### 4.2 接口设计规范

#### 4.2.1 RESTful API设计

- **基础路径**：`/api/v1/user`
- **请求格式**：JSON
- **响应格式**：JSON
- **状态码**：标准HTTP状态码

#### 4.2.2 统一响应格式

```json
{
    "code": 200,
    "message": "success",
    "data": {},
    "timestamp": 1640995200000
}
```

#### 4.2.3 核心接口列表

| 接口路径 | 方法 | 功能描述 | 权限要求 |
|----------|------|----------|----------|
| /register | POST | 用户注册 | 无 |
| /login | POST | 用户登录 | 无 |
| /logout | POST | 用户登出 | 登录用户 |
| /profile | GET | 获取用户信息 | 登录用户 |
| /profile | PUT | 更新用户信息 | 登录用户 |
| /password | PUT | 修改密码 | 登录用户 |
| /addresses | GET | 获取地址列表 | 登录用户 |
| /addresses | POST | 新增地址 | 登录用户 |
| /addresses/{id} | PUT | 更新地址 | 登录用户 |
| /addresses/{id} | DELETE | 删除地址 | 登录用户 |
| /points | GET | 获取积分信息 | 登录用户 |
| /points/logs | GET | 获取积分明细 | 登录用户 |

### 4.3 安全规范

#### 4.3.1 认证授权

- 使用JWT Token进行身份认证
- Token包含用户ID、角色、过期时间等信息
- 敏感操作需要二次验证

#### 4.3.2 数据加密

- 密码使用BCrypt加密，加盐处理
- 敏感信息(手机号、身份证)使用AES加密存储
- 数据传输使用HTTPS加密

#### 4.3.3 输入验证

- 所有用户输入进行格式验证和长度限制
- 防止SQL注入、XSS攻击
- 敏感词过滤

## 五、开发计划

### 5.1 开发阶段

**第一阶段（核心功能）**
- 用户注册登录
- 基础信息管理
- 密码管理
- 会话管理

**第二阶段（扩展功能）**
- 收货地址管理
- 实名认证
- 第三方登录

**第三阶段（高级功能）**
- 会员体系
- 积分系统
- 消息通知

### 5.2 测试要求

- 单元测试覆盖率≥80%
- 接口测试覆盖所有API
- 性能测试验证并发能力
- 安全测试验证安全防护

### 5.3 部署要求

- 支持Docker容器化部署
- 支持水平扩展
- 配置外部化管理
- 日志统一收集

## 六、风险评估

### 6.1 技术风险

- **数据库性能**：大量用户并发访问可能导致数据库性能瓶颈
- **缓存一致性**：Redis缓存与数据库数据一致性问题
- **第三方依赖**：短信、邮件服务商稳定性风险

### 6.2 安全风险

- **数据泄露**：用户敏感信息泄露风险
- **恶意攻击**：暴力破解、撞库攻击风险
- **权限绕过**：权限控制不当导致的安全风险

### 6.3 业务风险

- **用户体验**：复杂的认证流程可能影响用户体验
- **合规风险**：个人信息保护法规合规风险
- **运营风险**：积分系统被恶意刷取风险

## 七、附录

### 7.1 相关文档

- 《多平台电商系统需求文档》
- 《系统架构设计文档》
- 《数据库设计文档》
- 《接口设计文档》

### 7.2 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 1.0 | 2024-01-01 | 初始版本 | 开发团队 |

---

*本文档为用户模块需求规格说明书，如有疑问请联系产品团队。*